@model RecMan.Models.Resource

@{
    ViewBag.Title = "Details";
    ViewBag.ThisResource = "thisResource";
}

<head>
    <link href="~/Content/Site.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        //LIKE
       $("a.Like").on("click", function () {
            var link = "/Resource/Details/" + id;
            //Choose all a tags with this class and this ID
            //var a = $("a[class$='like'][data-id$='"+id+"']");
            $.ajax({
                type: "GET",
                cache: false,
                //url: '<%: Url.Resources("Details")%>',
                url: link = "/Resource/Details/" + id,
                data: {"id":id},
                success: function (result) {
                    a.html('<i class="fa fa-heart fa-lg text-danger"></i> <span>(' + result + ')</span>').addClass("like");
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $('#lblCommentsNotification').text("Error encountered while liking.");
                }
            });
        });

        /*$('#btnSaveComments').click(function () {
            var comments = $('#txtComments').val();
            var selectedId = $('#hdnSelectedId').val();

            $.ajax({
                url: '<%: Url.Action("SaveComments")%>',
                data: { 'id' : selectedId, 'comments' : comments },
                type: "post",
                cache: false,
                success: function (savingStatus) {
                    $("#hdnOrigComments").val($('#txtComments').val());
                    $('#lblCommentsNotification').text(savingStatus);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $('#lblCommentsNotification').text("Error encountered while saving the comments.");
                }
            });
        });*/

        /*$.ajax({
            url:/Resources/Details,
            data: "id=" + Id + "&param2=" + param2,
        type: "GET",
        success: function(data){
            // code here
        },
        error: function(passParams){
            // code here
        }
    });*/
        /*//UNLIKE
        $("a.unlike").click(function () {
            var id = $(this).data("id");
            var link = "/Resource/UnlikeThis/" + id;
            var a = $(this);
            $.ajax({
                type: "GET",
                url: link,
                success: function (result) {
                    a.html('<i class="fa fa-heart fa-lg text-danger"></i> (' + result + ')');
                }
            });*/
        });

    });
</script></head>


<body>
    <h2>
        <dd>
        @Html.DisplayFor(model => model.Title)
        </dd>
    </h2>

    <div>
        <h4>by @Html.DisplayFor(model => model.UserName)</h4>
        <hr />
        
            <table class="table table-bordered table-responsive table-hover">
                <tr>
                    <th>@Html.DisplayNameFor(model => model.Source)</th>
                    <th>@Html.DisplayNameFor(model => model.Level)</th>
                    <th>@Html.DisplayNameFor(model => model.Focus)</th>
                    <th>@Html.DisplayNameFor(model => model.Topic)</th>
                    <th>@Html.DisplayNameFor(model => model.LikeCount)</th>
                </tr>
 
                <tr>
                        <td>@Html.DisplayFor(model => model.Source)</td>
                        <td>@Html.DisplayFor(model => model.Level)</td>
                        <td>@Html.DisplayFor(model => model.Focus)</td>
                        <td>@Html.DisplayFor(model => model.Topic)</td>
                        <td>@Html.DisplayFor(model => model.LikeCount)</td>
                </tr>
               

                    @if (Model.Files.Any(f => f.ContentType == "image/jpeg"))
            {
                        <dt>
                            Avatar
                        </dt>
                        <dd>
                            <img src="~/File?id=@Model.Files.First(f => f.FileType == FileType.Avatar).FileId" alt="avatar" />
                        </dd>

                    }

                    @if (Model.Files.Any(f => f.ContentType == "application/pdf"))
            {
                var getData = ViewData["PDF"];

                        <object data="data:application/pdf;base64,@System.Convert.ToBase64String((Byte[])ViewData["PDF"])" type="application/pdf" width="500">
                            <embed src="data:application/pdf;base64, @System.Convert.ToBase64String((Byte[])ViewData["PDF"])" type="application/pdf" />
                        </object>
                    }





                    <dt>
                        @Html.DisplayNameFor(model => model.Comments)
                    </dt>

                    @foreach (var item in Model.Comments)
            {
                        <div>@item.UserName</div>
                        <div>@item.Message</div>
                        <p>posted</p>
                        <div>@item.DateTime</div>
                        <p>edited</p>
                        <div>@item.DateTimeEdit</div>
               
                        
                        
                        @Html.ActionLink("Edit", "../Comments/Edit", new { id = item.ID, ResId = Model.ResourceID });
                        @Html.ActionLink("Delete", "../Comments/Delete", new { id = item.ID, ResId = Model.ResourceID })
                        
                    }


                    @Html.ActionLink("Post a Comment", "../Comments/Create", new { id = Model.ResourceID }) |
                    @Html.ActionLink("Edit", "Edit", new { id = Model.ResourceID })
                    @Html.ActionLink("Like", "Details", new { id = item.ID })


                    @section Scripts {
                        @Scripts.Render("~/bundles/jqueryval")
                    }
</body>

